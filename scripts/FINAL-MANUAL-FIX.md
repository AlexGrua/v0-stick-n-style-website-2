# üö® –§–ò–ù–ê–õ–¨–ù–û–ï –†–£–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: POSTGREST –ö–ï–®

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê
PostgREST –∫–µ—à –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã, `/api/subcategories` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500.

## üîß –ü–û–®–ê–ì–û–í–û–ï –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ PostgREST –∫–µ—à–∞
1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Console** ‚Üí SQL Editor
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:**
```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: NOTIFY
NOTIFY pgrst, 'reload schema';

-- –í–∞—Ä–∏–∞–Ω—Ç 2: pg_notify (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
SELECT pg_notify('pgrst', 'reload schema');
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API –≤ Supabase
1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Console** ‚Üí Project Settings
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª API**
3. **–ù–∞–∂–º–∏—Ç–µ "Restart"** (—ç—Ç–æ —Å–∞–º—ã–π "–∂–µ—Å—Ç–∫–∏–π" —Å–±—Ä–æ—Å –∫–µ—à–∞)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `NEXT_PUBLIC_SUPABASE_URL` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –ë–î –∏ —Å—Ö–µ–º—ã
SELECT current_database(), current_schema();

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã subcategories
SELECT to_regclass('public.subcategories') as subcategories_table;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ products
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns
WHERE table_schema='public' 
  AND table_name='products' 
  AND column_name IN ('sku','subcategory_id','specifications');
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ exposed schemas
1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Console** ‚Üí Project Settings ‚Üí API
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ "Exposed schemas"** - —Ç–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å `public`
3. **–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –¥—Ä—É–≥–æ–π —Å—Ö–µ–º–µ** - –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ exposed schemas

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–ª—è anon –∏ service_role
SELECT grantee, table_name, privilege_type
FROM information_schema.role_table_grants
WHERE table_name IN ('products', 'categories', 'subcategories')
  AND grantee IN ('anon', 'service_role');
```

### –®–∞–≥ 6: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npm run dev
```

### –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É** http://localhost:3001/admin/catalog
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** - –æ—à–∏–±–∫–∏ FK –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–º–ø–æ—Ä—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤** - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

## üß™ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints
node scripts/test-api-endpoints.js

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
node scripts/check-migration-result.js
```

## üö® –ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–ê –û–°–¢–ê–ï–¢–°–Ø

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
–ï—Å–ª–∏ –∫–µ—à —É–ø–æ—Ä–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:

1. **–°–¥–µ–ª–∞–π—Ç–µ backup –¥–∞–Ω–Ω—ã—Ö** (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:**
```sql
-- –£–¥–∞–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS subcategories CASCADE;

-- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–æ–π
-- (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQL –∏–∑ scripts/execute-migration-full.sql)
```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API** –≤ Supabase
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

## üìã –ß–ï–ö–õ–ò–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

- [ ] NOTIFY pgrst, 'reload schema' –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] API –≤ Supabase –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] .env —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
- [ ] –¢–∞–±–ª–∏—Ü–∞ subcategories —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ö–æ–ª–æ–Ω–∫–∏ sku, subcategory_id, specifications –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] Exposed schemas –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –°–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –û—à–∏–±–∫–∏ FK –∏—Å—á–µ–∑–ª–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –ò–º–ø–æ—Ä—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–°—Ç–∞—Ç—É—Å:** üö® –¢–†–ï–ë–£–ï–¢ –†–£–ß–ù–û–ì–û –í–ú–ï–®–ê–¢–ï–õ–¨–°–¢–í–ê  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** ~10-15 –º–∏–Ω—É—Ç
